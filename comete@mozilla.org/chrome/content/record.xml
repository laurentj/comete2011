<?xml version="1.0"?>
<bindings
   xmlns="http://www.mozilla.org/xbl"
   xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
   xmlns:xbl="http://www.mozilla.org/xbl">

  <binding id="record-form">
    <content>
        <xul:hbox>
            <xul:vbox flex="1">
                <xul:label value="Description" />
                <xul:textbox anonid="tbDescription"/>
            </xul:vbox>
            <xul:vbox flex="1">
                <xul:label value="Amount" />
                <xul:textbox anonid="tbMontant"/>
            </xul:vbox>
            <xul:button label="Add" oncommand="this.parentNode.parentNode.addRow()"/>
            <xul:button label="Modify" oncommand="this.parentNode.parentNode.modifyRow()" />
            <xul:button label="Delete" oncommand="this.parentNode.parentNode.deleteRow()" />
        </xul:hbox>
    </content>
    
    <implementation>
      <property name="description">
         <getter>
           return document.getAnonymousElementByAttribute(this, 'anonid', 'tbDescription').value;
         </getter>
          <setter>
          document.getAnonymousElementByAttribute(this, 'anonid', 'tbDescription').value = val;
          </setter>
      </property>
      
      <property name="montant">
         <getter>
           return document.getAnonymousElementByAttribute(this, 'anonid', 'tbMontant').value;
         </getter>
          <setter>
          document.getAnonymousElementByAttribute(this, 'anonid', 'tbMontant').value = val;
          </setter>
      </property>

        <property name="listbox" readonly="true">
            <getter>
                return document.getElementById(this.getAttribute('list'));
            </getter>
        </property>

      <method name="addRow">
        <body><![CDATA[
            
            // créer les elements à integrer dans la listbox
            var labDesc = document.createElement('label');
            var labMontant = document.createElement('label');

            labDesc.setAttribute('value', this.description );
            labMontant.setAttribute('value', this.montant );
            
            var item = document.createElement('listitem');
            item.appendChild(labDesc);
            item.appendChild(labMontant);
        
            // insérer les nouveaux elements dans la listbox
            this.listbox.appendChild(item);

            myDatamanager.addData(this.description,this.montant);

            // nettoyer le formulaire
            this.description = '';
            this.montant = '';
        ]]></body>
      </method>
      <method name="modifyRow">
        <body><![CDATA[
            // récupération de l'élement sélectionné
            var item    = this.listbox.selectedItem;
            
            if (item == null) {
                window.alert('Select an item');
                return;
            }
            myDatamanager.modifyData(this.listbox.selectedIndex, this.description, this.montant);

            item.children[0].setAttribute('value', this.description);
            item.children[1].setAttribute('value', this.montant);
        ]]></body>
      </method>
      <method name="deleteRow">
        <body><![CDATA[
            // récupération de l'élement sélectionné
            var item    = this.listbox.selectedItem;
            
            if (item == null) {
                window.alert('Select an item');
                return;
            }
            
            if (window.confirm("Are you sure to delete?")) {
                myDatamanager.delData(this.listbox.selectedIndex);
                this.listbox.removeChild(item);
                // nettoyer le formulaire
                this.description = '';
                this.montant = '';
            }
        ]]></body>
      </method>
    </implementation>

  </binding>

</bindings>