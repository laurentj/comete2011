<?xml version="1.0"?>
<bindings
   xmlns="http://www.mozilla.org/xbl"
   xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
   xmlns:xbl="http://www.mozilla.org/xbl">

  <binding id="record-form">
    <content>
        <xul:hbox>
            <xul:vbox flex="1">
                <xul:label value="Description" />
                <xul:textbox anonid="tbDescription"/>
            </xul:vbox>
            <xul:vbox flex="1">
                <xul:label value="Amount" />
                <xul:textbox anonid="tbMontant"/>
            </xul:vbox>
            <xul:button label="Add" oncommand="this.parentNode.parentNode.addRow()"/>
            <xul:button label="Modify" oncommand="this.parentNode.parentNode.modifyRow()" />
            <xul:button label="Delete" oncommand="this.parentNode.parentNode.deleteRow()" />
        </xul:hbox>
    </content>
    
    <implementation>
      
      <method name="addRow">
        <body><![CDATA[
            // récuperer les valeurs
            var desc = document.getAnonymousElementByAttribute(this, 'anonid', 'tbDescription').value;
            var montant = document.getAnonymousElementByAttribute(this, 'anonid', 'tbMontant').value;
            
            // créer les elements à integrer dans la listbox
            var labDesc = document.createElement('label');
            var labMontant = document.createElement('label');
            
            labDesc.setAttribute('value', desc );
            labMontant.setAttribute('value', montant );
            
            var item = document.createElement('listitem');
            item.appendChild(labDesc);
            item.appendChild(labMontant);
        
            // insérer les nouveaux elements dans la listbox
            var listbox = document.getElementById('comptes');
            listbox.appendChild(item);
            
            // nettoyer le formulaire
            document.getAnonymousElementByAttribute(this, 'anonid','tbDescription').value = '';
            document.getAnonymousElementByAttribute(this, 'anonid','tbMontant').value = '';


        ]]></body>
      </method>
      <method name="modifyRow">
        <body><![CDATA[
            // récupération de la listbox
            var listbox = document.getElementById('comptes');
            // récupération de l'élement sélectionné
            var item    = listbox.selectedItem;
            
            if (item == null) {
                window.alert('Select an item');
                return;
            }
        
            // récuperer les valeurs
            var desc =  document.getAnonymousElementByAttribute(this, 'anonid','tbDescription').value;
            var montant = document.getAnonymousElementByAttribute(this, 'anonid','tbMontant').value;
            
            item.children[0].setAttribute('value', desc);
            item.children[1].setAttribute('value', montant);
        ]]></body>
      </method>
      <method name="deleteRow">
        <body><![CDATA[
            // récupération de la listbox
            var listbox = document.getElementById('comptes');
            // récupération de l'élement sélectionné
            var item    = listbox.selectedItem;
            
            if (item == null) {
                window.alert('Select an item');
                return;
            }
            
            if (window.confirm("Are you sure to delete?")) {
                listbox.removeChild(item);
                // nettoyer le formulaire
                document.getAnonymousElementByAttribute(this, 'anonid','tbDescription').value = '';
                document.getAnonymousElementByAttribute(this, 'anonid','tbMontant').value = '';
            }
        ]]></body>
      </method>
    </implementation>

  </binding>

</bindings>